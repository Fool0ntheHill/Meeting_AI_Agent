# æ–°é¡¹ç›®æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ å½“å‰æ¶æ„é—®é¢˜åˆ†æ

### 1. ä»£ç ç»„ç»‡é—®é¢˜

**ç°çŠ¶**ï¼š
- æ‰€æœ‰é€»è¾‘éƒ½åœ¨å•ä¸ªç±»ä¸­ï¼ˆå¦‚ `VolcanoTranscriberV3`ï¼‰
- é…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- ç¼ºå°‘ç»Ÿä¸€çš„æ¥å£æŠ½è±¡
- æ¨¡å—é—´è€¦åˆåº¦é«˜

**é—®é¢˜**ï¼š
- éš¾ä»¥æ‰©å±•æ–°çš„ ASR æä¾›å•†
- éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•
- é…ç½®ç®¡ç†æ··ä¹±
- ä¸é€‚åˆ Web API é›†æˆ

### 2. é¢å‘å¯¹è±¡è®¾è®¡é—®é¢˜

**ç°çŠ¶**ï¼š
- ç¼ºå°‘æŠ½è±¡åŸºç±»
- ç»§æ‰¿å…³ç³»ä¸æ¸…æ™°ï¼ˆ`TranscriptionTester` æ—¢æ˜¯æµ‹è¯•ç±»åˆæ˜¯åŸºç±»ï¼‰
- èŒè´£ä¸å•ä¸€ï¼ˆä¸€ä¸ªç±»åšå¤ªå¤šäº‹æƒ…ï¼‰

**é—®é¢˜**ï¼š
- è¿åå•ä¸€èŒè´£åŸåˆ™
- è¿åå¼€é—­åŸåˆ™
- éš¾ä»¥æ›¿æ¢å®ç°

### 3. Web é›†æˆé—®é¢˜

**ç°çŠ¶**ï¼š
- æ²¡æœ‰ç»Ÿä¸€çš„è¯·æ±‚/å“åº”æ ¼å¼
- ç¼ºå°‘å¼‚å¸¸å¤„ç†æœºåˆ¶
- æ²¡æœ‰æ—¥å¿—ç³»ç»Ÿ
- ç¼ºå°‘é…ç½®ç®¡ç†

**é—®é¢˜**ï¼š
- æ— æ³•ç›´æ¥ç”¨äº Web API
- é”™è¯¯ä¿¡æ¯ä¸å‹å¥½
- éš¾ä»¥è°ƒè¯•å’Œç›‘æ§

---

## ğŸ¯ æ¨èæ¶æ„ï¼šåˆ†å±‚ + ä¾èµ–æ³¨å…¥

```
æ–°é¡¹ç›®/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒæŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ interfaces.py          # æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ exceptions.py          # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ settings.py            # é…ç½®ç±»
â”‚   â”‚   â””â”€â”€ loader.py              # é…ç½®åŠ è½½å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/                 # æœåŠ¡æä¾›å•†å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ asr/                   # ASR æä¾›å•†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py            # ASR åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ volcano.py         # ç«å±±å¼•æ“å®ç°
â”‚   â”‚   â”‚   â””â”€â”€ azure.py           # Azure å®ç°
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ voiceprint/            # å£°çº¹è¯†åˆ«æä¾›å•†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â””â”€â”€ iflytek.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ llm/                   # LLM æä¾›å•†
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py
â”‚   â”‚       â””â”€â”€ gemini.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ transcription.py       # è½¬å†™æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ speaker_recognition.py # è¯´è¯äººè¯†åˆ«æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ correction.py          # ASR ä¿®æ­£æœåŠ¡
â”‚   â”‚   â””â”€â”€ summarization.py       # æ€»ç»“æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ audio.py               # éŸ³é¢‘å¤„ç†
â”‚   â”‚   â”œâ”€â”€ storage.py             # å­˜å‚¨æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ logger.py              # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ metrics.py             # è¯„ä¼°æŒ‡æ ‡
â”‚   â”‚
â”‚   â””â”€â”€ api/                       # API å±‚ï¼ˆWeb æ¥å£ï¼‰
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ schemas.py             # è¯·æ±‚/å“åº”æ¨¡å‹
â”‚       â”œâ”€â”€ routes.py              # è·¯ç”±å®šä¹‰
â”‚       â””â”€â”€ dependencies.py        # ä¾èµ–æ³¨å…¥
â”‚
â”œâ”€â”€ tests/                         # æµ‹è¯•
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ development.yaml
â”‚   â”œâ”€â”€ production.yaml
â”‚   â””â”€â”€ test.yaml
â”‚
â”œâ”€â”€ scripts/                       # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ migrate_data.py
â”‚   â””â”€â”€ register_speakers.py
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ setup.py
â””â”€â”€ README.md
```

---

## ğŸ”§ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ¥å£æŠ½è±¡ï¼ˆInterface Segregationï¼‰

**å®šä¹‰ç»Ÿä¸€æ¥å£**ï¼š

```python
# src/core/interfaces.py
from abc import ABC, abstractmethod
from typing import Dict, List, Optional
from .models import TranscriptionResult, SpeakerIdentity

class ASRProvider(ABC):
    """ASR æä¾›å•†æŠ½è±¡æ¥å£"""
    
    @abstractmethod
    def transcribe(self, audio_url: str, **kwargs) -> TranscriptionResult:
        """è½¬å†™éŸ³é¢‘"""
        pass
    
    @abstractmethod
    def get_supported_formats(self) -> List[str]:
        """è·å–æ”¯æŒçš„éŸ³é¢‘æ ¼å¼"""
        pass
    
    @abstractmethod
    def validate_config(self) -> bool:
        """éªŒè¯é…ç½®"""
        pass

class VoiceprintProvider(ABC):
    """å£°çº¹è¯†åˆ«æä¾›å•†æŠ½è±¡æ¥å£"""
    
    @abstractmethod
    def identify(self, audio_bytes: bytes, **kwargs) -> Optional[SpeakerIdentity]:
        """è¯†åˆ«è¯´è¯äºº"""
        pass
    
    @abstractmethod
    def register(self, audio_bytes: bytes, speaker_id: str, name: str) -> bool:
        """æ³¨å†Œè¯´è¯äºº"""
        pass

class LLMProvider(ABC):
    """LLM æä¾›å•†æŠ½è±¡æ¥å£"""
    
    @abstractmethod
    def summarize(self, transcript: str, strategy: str) -> str:
        """ç”Ÿæˆä¼šè®®æ€»ç»“"""
        pass
```

### 2. æ•°æ®æ¨¡å‹ï¼ˆData Modelsï¼‰

**ä½¿ç”¨ Pydantic å®šä¹‰æ•°æ®æ¨¡å‹**ï¼š

```python
# src/core/models.py
from pydantic import BaseModel, Field
from typing import List, Optional
from datetime import datetime

class Segment(BaseModel):
    """è½¬å†™ç‰‡æ®µ"""
    text: str
    start_time: float  # ç§’
    end_time: float
    speaker: str
    confidence: Optional[float] = None

class TranscriptionResult(BaseModel):
    """è½¬å†™ç»“æœ"""
    segments: List[Segment]
    full_text: str
    duration: float
    language: str = "zh-CN"
    provider: str
    created_at: datetime = Field(default_factory=datetime.now)

class SpeakerIdentity(BaseModel):
    """è¯´è¯äººèº«ä»½"""
    speaker_id: str
    name: str
    confidence: float
    metadata: Optional[Dict] = None

class MeetingMinutes(BaseModel):
    """ä¼šè®®çºªè¦"""
    title: str
    participants: List[str]
    summary: str
    key_points: List[str]
    action_items: List[str]
    created_at: datetime = Field(default_factory=datetime.now)
```

### 3. é…ç½®ç®¡ç†ï¼ˆConfiguration Managementï¼‰

**ä½¿ç”¨ YAML + Pydantic**ï¼š

```python
# src/config/settings.py
from pydantic_settings import BaseSettings
from typing import Optional

class VolcanoConfig(BaseSettings):
    """ç«å±±å¼•æ“é…ç½®"""
    app_id: str
    access_token: str
    tos_access_key: str
    tos_secret_key: str
    tos_endpoint: str
    tos_region: str
    tos_bucket: str
    
    class Config:
        env_prefix = "VOLCANO_"

class IFlyTekConfig(BaseSettings):
    """è®¯é£é…ç½®"""
    app_id: str
    api_key: str
    api_secret: str
    group_id: str
    
    class Config:
        env_prefix = "IFLYTEK_"

class GeminiConfig(BaseSettings):
    """Gemini é…ç½®"""
    api_key: str
    model: str = "gemini-3-pro"
    
    class Config:
        env_prefix = "GEMINI_"

class AppConfig(BaseSettings):
    """åº”ç”¨é…ç½®"""
    volcano: VolcanoConfig
    iflytek: IFlyTekConfig
    gemini: GeminiConfig
    
    log_level: str = "INFO"
    max_workers: int = 4
    
    class Config:
        env_file = ".env"
```

### 4. ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰

**ä½¿ç”¨å·¥å‚æ¨¡å¼**ï¼š

```python
# src/api/dependencies.py
from functools import lru_cache
from src.config.settings import AppConfig
from src.providers.asr.volcano import VolcanoASR
from src.providers.voiceprint.iflytek import IFlyTekVoiceprint
from src.services.transcription import TranscriptionService

@lru_cache()
def get_config() -> AppConfig:
    """è·å–é…ç½®ï¼ˆå•ä¾‹ï¼‰"""
    return AppConfig()

def get_asr_provider():
    """è·å– ASR æä¾›å•†"""
    config = get_config()
    return VolcanoASR(config.volcano)

def get_voiceprint_provider():
    """è·å–å£°çº¹è¯†åˆ«æä¾›å•†"""
    config = get_config()
    return IFlyTekVoiceprint(config.iflytek)

def get_transcription_service():
    """è·å–è½¬å†™æœåŠ¡"""
    return TranscriptionService(
        asr_provider=get_asr_provider(),
        voiceprint_provider=get_voiceprint_provider()
    )
```

---

## ğŸ“ å®ç°ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç«å±±å¼•æ“ ASR å®ç°

```python
# src/providers/asr/volcano.py
from src.core.interfaces import ASRProvider
from src.core.models import TranscriptionResult, Segment
from src.config.settings import VolcanoConfig
import requests

class VolcanoASR(ASRProvider):
    """ç«å±±å¼•æ“ ASR å®ç°"""
    
    def __init__(self, config: VolcanoConfig):
        self.config = config
        self.submit_url = "https://openspeech-direct.zijieapi.com/api/v3/auc/bigmodel/submit"
        self.query_url = "https://openspeech-direct.zijieapi.com/api/v3/auc/bigmodel/query"
    
    def transcribe(self, audio_url: str, **kwargs) -> TranscriptionResult:
        """è½¬å†™éŸ³é¢‘"""
        # 1. æäº¤ä»»åŠ¡
        task_id = self._submit_task(audio_url)
        
        # 2. è½®è¯¢ç»“æœ
        result = self._poll_result(task_id)
        
        # 3. è§£æå¹¶è¿”å›
        return self._parse_result(result)
    
    def get_supported_formats(self) -> List[str]:
        return ["wav", "mp3", "ogg", "flac"]
    
    def validate_config(self) -> bool:
        return bool(self.config.app_id and self.config.access_token)
    
    def _submit_task(self, audio_url: str) -> str:
        """æäº¤ä»»åŠ¡ï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰"""
        # å®ç°ç»†èŠ‚...
        pass
    
    def _poll_result(self, task_id: str) -> dict:
        """è½®è¯¢ç»“æœï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰"""
        # å®ç°ç»†èŠ‚...
        pass
    
    def _parse_result(self, raw_result: dict) -> TranscriptionResult:
        """è§£æç»“æœï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰"""
        # å®ç°ç»†èŠ‚...
        pass
```

### ç¤ºä¾‹ 2: è½¬å†™æœåŠ¡ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰

```python
# src/services/transcription.py
from src.core.interfaces import ASRProvider, VoiceprintProvider
from src.core.models import TranscriptionResult, MeetingTranscript
from src.utils.logger import get_logger

logger = get_logger(__name__)

class TranscriptionService:
    """è½¬å†™æœåŠ¡"""
    
    def __init__(
        self,
        asr_provider: ASRProvider,
        voiceprint_provider: VoiceprintProvider
    ):
        self.asr = asr_provider
        self.voiceprint = voiceprint_provider
    
    def process_meeting(
        self,
        audio_url: str,
        enable_speaker_recognition: bool = True
    ) -> MeetingTranscript:
        """å¤„ç†ä¼šè®®å½•éŸ³"""
        logger.info(f"å¼€å§‹å¤„ç†ä¼šè®®: {audio_url}")
        
        try:
            # 1. ASR è½¬å†™
            logger.info("æ­¥éª¤ 1: ASR è½¬å†™")
            transcription = self.asr.transcribe(audio_url)
            
            # 2. è¯´è¯äººè¯†åˆ«ï¼ˆå¯é€‰ï¼‰
            if enable_speaker_recognition:
                logger.info("æ­¥éª¤ 2: è¯´è¯äººè¯†åˆ«")
                transcription = self._identify_speakers(transcription)
            
            # 3. æ„é€ ç»“æœ
            result = MeetingTranscript(
                transcription=transcription,
                audio_url=audio_url
            )
            
            logger.info("å¤„ç†å®Œæˆ")
            return result
            
        except Exception as e:
            logger.error(f"å¤„ç†å¤±è´¥: {e}")
            raise
    
    def _identify_speakers(
        self,
        transcription: TranscriptionResult
    ) -> TranscriptionResult:
        """è¯†åˆ«è¯´è¯äººï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰"""
        # å®ç°ç»†èŠ‚...
        pass
```

### ç¤ºä¾‹ 3: Web API è·¯ç”±

```python
# src/api/routes.py
from fastapi import APIRouter, Depends, HTTPException
from src.api.schemas import TranscriptionRequest, TranscriptionResponse
from src.api.dependencies import get_transcription_service
from src.services.transcription import TranscriptionService

router = APIRouter(prefix="/api/v1")

@router.post("/transcribe", response_model=TranscriptionResponse)
async def transcribe_audio(
    request: TranscriptionRequest,
    service: TranscriptionService = Depends(get_transcription_service)
):
    """è½¬å†™éŸ³é¢‘æ¥å£"""
    try:
        result = service.process_meeting(
            audio_url=request.audio_url,
            enable_speaker_recognition=request.enable_speaker_recognition
        )
        
        return TranscriptionResponse(
            success=True,
            data=result
        )
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

---

## ğŸ¯ å…³é”®ä¼˜åŠ¿

### 1. æ˜“äºæ‰©å±•
- æ–°å¢ ASR æä¾›å•†ï¼šåªéœ€å®ç° `ASRProvider` æ¥å£
- æ–°å¢åŠŸèƒ½ï¼šåœ¨ `services/` å±‚æ·»åŠ æ–°æœåŠ¡
- ä¸å½±å“ç°æœ‰ä»£ç 

### 2. æ˜“äºæµ‹è¯•
- æ¥å£å¯ä»¥ Mock
- ä¾èµ–æ³¨å…¥ä¾¿äºå•å…ƒæµ‹è¯•
- ä¸šåŠ¡é€»è¾‘ä¸å®ç°è§£è€¦

### 3. æ˜“äºç»´æŠ¤
- èŒè´£æ¸…æ™°ï¼Œå•ä¸€èŒè´£
- é…ç½®é›†ä¸­ç®¡ç†
- æ—¥å¿—å’Œå¼‚å¸¸ç»Ÿä¸€å¤„ç†

### 4. é€‚åˆ Web é›†æˆ
- ç»Ÿä¸€çš„è¯·æ±‚/å“åº”æ ¼å¼
- ä¾èµ–æ³¨å…¥æ”¯æŒ
- å¼‚æ­¥æ”¯æŒï¼ˆFastAPIï¼‰

---

## ğŸ“¦ è¿ç§»æ­¥éª¤

### é˜¶æ®µ 1: æ ¸å¿ƒæŠ½è±¡ï¼ˆ1-2å¤©ï¼‰
1. å®šä¹‰æ¥å£ï¼ˆ`interfaces.py`ï¼‰
2. å®šä¹‰æ•°æ®æ¨¡å‹ï¼ˆ`models.py`ï¼‰
3. é…ç½®ç®¡ç†ï¼ˆ`settings.py`ï¼‰

### é˜¶æ®µ 2: æä¾›å•†å®ç°ï¼ˆ3-5å¤©ï¼‰
1. é‡æ„ç«å±±å¼•æ“ ASR
2. é‡æ„ Azure ASR
3. é‡æ„è®¯é£å£°çº¹è¯†åˆ«
4. å®ç° Gemini LLM

### é˜¶æ®µ 3: ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆ2-3å¤©ï¼‰
1. è½¬å†™æœåŠ¡
2. è¯´è¯äººè¯†åˆ«æœåŠ¡
3. ASR ä¿®æ­£æœåŠ¡
4. æ€»ç»“æœåŠ¡

### é˜¶æ®µ 4: API å±‚ï¼ˆ2-3å¤©ï¼‰
1. å®šä¹‰ API Schema
2. å®ç°è·¯ç”±
3. ä¾èµ–æ³¨å…¥
4. å¼‚å¸¸å¤„ç†

### é˜¶æ®µ 5: æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ2-3å¤©ï¼‰
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. API æ–‡æ¡£
4. éƒ¨ç½²æ–‡æ¡£

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¡®è®¤æ¶æ„æ–¹æ¡ˆ**ï¼šè®¨è®ºå¹¶ç¡®å®šæœ€ç»ˆæ¶æ„
2. **åˆ›å»ºæ–°é¡¹ç›®éª¨æ¶**ï¼šæŒ‰ç…§ç›®å½•ç»“æ„åˆ›å»ºç©ºæ–‡ä»¶
3. **é€æ­¥è¿ç§»ä»£ç **ï¼šä»æ ¸å¿ƒæŠ½è±¡å¼€å§‹ï¼Œé€å±‚å®ç°
4. **ç¼–å†™æµ‹è¯•**ï¼šç¡®ä¿è¿ç§»ååŠŸèƒ½æ­£å¸¸
5. **é›†æˆ Web API**ï¼šå®ç° FastAPI æ¥å£

---

**é¢„è®¡æ€»å·¥æœŸ**: 10-15 å¤©ï¼ˆ1-2 äººï¼‰

**å»ºè®®**: é‡‡ç”¨å¢é‡è¿ç§»ï¼Œå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥å®Œå–„
