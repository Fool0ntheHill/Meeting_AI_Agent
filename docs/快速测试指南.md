# 快速测试指南

本指南帮助你快速运行端到端测试,验证系统功能。

## 当前状态

✅ **已完成**:
- 项目基础设施搭建
- 核心抽象层实现
- 所有服务提供商实现(ASR、LLM、声纹识别)
- 业务服务层实现(转写、识别、修正、生成)
- 管线编排服务实现
- 153 个单元测试全部通过
- 测试配置文件已准备好
- 配置检查工具已就绪

✅ **配置状态**:
- 火山引擎 ASR: ✓ 已配置
- Gemini LLM: ✓ 已配置(2个密钥)
- Azure ASR: ✓ 已配置(备用)
- 科大讯飞声纹识别: ✓ 已配置(需要创建声纹库)
- TOS 存储: ✓ 已配置

⚠️ **待完成**:
- 准备测试音频文件
- 运行端到端测试

## 快速开始(3步)

### 步骤 0: 确认 Python 版本

⚠️ **重要**: 项目需要 Python 3.12 版本(不支持 3.14)

**快速检查** (推荐):

```bash
# Windows: 运行检查脚本
.\scripts\check_python.bat

# 或手动检查
python --version
# 应该显示 Python 3.12.x
```

**如果版本不对**:

1. **查看详细安装指南**: [Windows 安装 Python 3.12 指南](./install_python312_windows.md)

2. **快速安装选项**:
   - 方法 1: 使用 pyenv-win (推荐)
   - 方法 2: 直接下载安装 Python 3.12
   - 方法 3: 使用 py launcher (如果已安装 Python 3.12)

3. **使用自动化脚本** (如果已安装 Python 3.12):
   ```powershell
   # PowerShell 中运行
   .\scripts\setup_python312.ps1
   ```

详细说明请查看: [docs/install_python312_windows.md](./install_python312_windows.md)

### 步骤 1: 验证配置

运行配置检查工具:

```bash
python scripts/check_config.py --config config/test.yaml
```

预期输出:
```
✓ 配置检查通过!
```

### 步骤 2: 准备测试音频

将你的会议录音文件放到 `test_data/` 目录:

```bash
# 复制你的音频文件
cp /path/to/your/meeting.wav test_data/

# 或者录制一段测试音频(1-3分钟)
```

**音频要求**:
- 格式: WAV, MP3, M4A 等
- 时长: 1-5 分钟(首次测试)
- 内容: 包含对话的会议录音

### 步骤 3: 运行测试

**推荐使用限制输出版本** (避免音频二进制数据输出问题):

```bash
# 基础测试(跳过说话人识别) - 推荐
python scripts/test_e2e_limited.py \
  --audio test_data/meeting.wav \
  --skip-speaker-recognition \
  --config config/test.yaml

# 完整测试(包含说话人识别,需要先创建声纹库)
python scripts/test_e2e_limited.py \
  --audio test_data/meeting.wav \
  --config config/test.yaml
```

**或使用原始版本** (完整输出,可能有大量二进制数据):

```bash
# 基础测试(跳过说话人识别)
python scripts/test_e2e.py \
  --audio test_data/meeting.wav \
  --skip-speaker-recognition \
  --config config/test.yaml

# 完整测试(包含说话人识别,需要先创建声纹库)
python scripts/test_e2e.py \
  --audio test_data/meeting.wav \
  --config config/test.yaml
```

## 测试输出示例

成功运行后,你会看到:

```
================================================================================
开始端到端集成测试
================================================================================

[1/7] 初始化服务...
✓ 服务初始化完成

[2/7] 准备测试数据...
✓ 任务 ID: test_task_1234567890.123
✓ 音频文件: ['test_data/meeting.wav']

[3/7] 开始管线处理...
Task test_task_xxx: Starting transcription phase
Task test_task_xxx: Transcription completed, duration=120.5s, segments=45
Task test_task_xxx: Starting correction phase
Task test_task_xxx: Correction completed
Task test_task_xxx: Starting artifact generation phase
Task test_task_xxx: Artifact generation completed
✓ 管线处理完成

[4/7] 处理结果:
  - Artifact ID: art_test_task_xxx_meeting_minutes_v1
  - 任务 ID: test_task_xxx
  - 内容类型: meeting_minutes
  - 版本: 1

[5/7] 会议纪要内容:
{
  "title": "测试会议",
  "participants": ["说话人1", "说话人2"],
  "summary": "本次会议讨论了...",
  "key_points": ["要点1", "要点2"],
  "action_items": ["行动项1", "行动项2"]
}

[6/7] 统计信息:
  - 会议标题: 测试会议
  - 参与者数量: 2
  - 关键要点数量: 2
  - 行动项数量: 2

[7/7] 测试完成!
================================================================================
✓ 端到端集成测试成功
================================================================================
```

## 测试场景

### 场景 1: 基础测试(推荐首次使用)

跳过说话人识别,只测试核心功能:

```bash
# 推荐: 使用限制输出版本
python scripts/test_e2e_limited.py \
  --audio test_data/meeting.wav \
  --skip-speaker-recognition \
  --config config/test.yaml

# 或使用原始版本
python scripts/test_e2e.py \
  --audio test_data/meeting.wav \
  --skip-speaker-recognition \
  --config config/test.yaml
```

**测试内容**:
- ✓ 音频转写(ASR)
- ✓ ASR 修正
- ✓ 会议纪要生成(LLM)

### 场景 2: 完整测试

包含说话人识别(需要先创建声纹库):

```bash
# 推荐: 使用限制输出版本
python scripts/test_e2e_limited.py \
  --audio test_data/meeting.wav \
  --config config/test.yaml

# 或使用原始版本
python scripts/test_e2e.py \
  --audio test_data/meeting.wav \
  --config config/test.yaml
```

**测试内容**:
- ✓ 音频转写(ASR)
- ✓ 说话人识别(声纹)
- ✓ ASR 修正
- ✓ 会议纪要生成(LLM)

### 场景 3: 多文件测试

测试多个音频文件拼接:

```bash
python scripts/test_e2e_limited.py \
  --audio test_data/part1.wav test_data/part2.wav \
  --file-order 0 1 \
  --skip-speaker-recognition \
  --config config/test.yaml
```

### 场景 4: 自定义会议描述

添加会议上下文信息:

```bash
python scripts/test_e2e_limited.py \
  --audio test_data/meeting.wav \
  --description "产品规划会议 - 讨论 Q2 路线图" \
  --skip-speaker-recognition \
  --config config/test.yaml
```

## 常见问题

### Q0: Python 版本问题

**问题**: 音频处理时输出大量二进制数据,或 pyhub 库报错

**解决**:
1. 确认使用 Python 3.12 版本: `python --version`
2. 不要使用 Python 3.14 (pyhub 不支持)
3. 使用限制输出版本的测试脚本: `test_e2e_limited.py`

详见: [Python 版本更新说明](./python_version_update.md)

### Q1: 配置检查失败

**问题**: `✗ 配置加载失败`

**解决**:
1. 检查 `config/test.yaml` 文件是否存在
2. 确认所有必需的 API 密钥已填写
3. 运行 `python scripts/check_config.py --config config/test.yaml` 查看详细错误

### Q2: 音频文件不存在

**问题**: `音频文件不存在: test_data/meeting.wav`

**解决**:
1. 确保音频文件已放到 `test_data/` 目录
2. 检查文件路径是否正确
3. 参考 `test_data/README.md` 准备音频文件

### Q3: API 调用失败

**问题**: `✗ 管线处理失败: Authentication failed`

**解决**:
1. 检查 API 密钥是否正确
2. 确认 API 服务已开通
3. 检查网络连接是否正常
4. 查看 API 配额是否充足

### Q4: 声纹识别失败

**问题**: `✗ 管线处理失败: Group not found`

**解决**:
1. 使用 `--skip-speaker-recognition` 跳过说话人识别
2. 或者先创建科大讯飞声纹库,填写 `group_id`

### Q5: 音频格式不支持

**问题**: `✗ 音频处理失败: Unsupported audio format`

**解决**:
使用 ffmpeg 转换音频格式:
```bash
ffmpeg -i input.mp3 -ar 16000 -ac 1 output.wav
```

## 性能参考

基于 5 分钟会议录音的预估时间:

| 阶段 | 预估时间 | 说明 |
|------|---------|------|
| 音频转写 | 30-60秒 | 取决于音频时长和网络速度 |
| 说话人识别 | 10-20秒 | 可选,取决于说话人数量 |
| ASR 修正 | < 1秒 | 本地处理 |
| 会议纪要生成 | 10-30秒 | 取决于转写文本长度 |
| **总计** | **1-2分钟** | 完整流程 |

## 下一步

测试成功后,你可以:

1. **查看实现代码**: 了解各个服务的实现细节
   - `src/services/pipeline.py` - 管线编排
   - `src/services/transcription.py` - 音频转写
   - `src/services/artifact_generation.py` - 内容生成

2. **调整配置**: 优化参数以获得更好的效果
   - 调整 LLM temperature
   - 修改提示词模板
   - 配置热词列表

3. **继续开发**: 实现剩余功能
   - 数据库层(Task 16-18)
   - API 层(Task 19-21)
   - Worker 层(Task 22-24)

4. **部署上线**: 参考部署文档进行生产环境部署

## 相关文档

- [Python 版本更新说明](./python_version_update.md) - Python 3.12 版本要求和限制输出测试
- [测试配置指南](./测试配置指南.md) - 详细的配置说明
- [测试说明](./测试说明.md) - 完整的测试文档
- [快速开始](./快速开始.md) - 5分钟快速开始指南
- [需求文档](../.kiro/specs/meeting-minutes-agent/requirements.md) - 48个需求
- [设计文档](../.kiro/specs/meeting-minutes-agent/design.md) - 完整架构设计
- [任务列表](../.kiro/specs/meeting-minutes-agent/tasks.md) - 31个实施任务

## 技术支持

如有问题:
1. 查看 `docs/测试说明.md` 的故障排查章节
2. 检查 API 提供商的官方文档
3. 查看项目 README.md

---

**提示**: 
- 首次测试建议使用较短的音频文件(1-3分钟),并使用 `--skip-speaker-recognition` 选项,以快速验证核心功能
- **推荐使用 `test_e2e_limited.py`** 避免音频二进制数据输出问题
- 确保使用 **Python 3.12** 版本(不支持 3.14)
