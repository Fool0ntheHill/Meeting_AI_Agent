# 新项目迁移清单

## 🎯 新项目架构

```
会议AI助手
├── ASR 语音转写
│   ├── 主力：火山引擎
│   └── 备用：Azure
├── 声纹识别
│   └── 科大讯飞
└── LLM 会议总结
    └── Gemini 3 Pro
```

---

## 📦 需要迁移的核心文件

### 1️⃣ ASR 语音转写模块

#### 火山引擎（主力）

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `volcano_transcriber_v3.py` | `transcribers/` | 火山引擎转写器（最新版） | ⭐⭐⭐ 必需 |
| `火山API文档.txt` | `api docs/` | API 文档参考 | ⭐⭐ 重要 |
| `火山热词.txt` | `api docs/` | 热词配置参考 | ⭐ 可选 |

**核心功能**：
- ✅ TOS 对象存储集成
- ✅ 说话人分离（diarization）
- ✅ 中英文混合识别
- ✅ 时间戳精度最高（348ms）

#### Azure（备用）

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `azure_transcriber.py` | `transcribers/` | Azure 转写器 | ⭐⭐⭐ 必需 |
| `azure api文档.txt` | `api docs/` | API 文档参考 | ⭐⭐ 重要 |
| `AzureSecretKey.csv` | `config/` | 密钥配置 | ⭐⭐⭐ 必需 |

**核心功能**：
- ✅ 本地文件直接上传
- ✅ 说话人分离（eastus 区域）
- ✅ 自动切分大文件

---

### 2️⃣ 声纹识别模块

#### 科大讯飞

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `iflytek_voiceprint.py` | 根目录 | 讯飞声纹识别客户端 | ⭐⭐⭐ 必需 |
| `audio_processor.py` | 根目录 | 音频处理器（提取声纹样本） | ⭐⭐⭐ 必需 |
| `讯飞声纹识别api.txt` | `api docs/` | API 文档参考 | ⭐⭐ 重要 |

**核心功能**：
- ✅ 1:N 说话人检索
- ✅ 1:1 说话人验证
- ✅ 声纹特征管理
- ✅ 分差挽救机制（Gap Rescue）

**关键技术**：
- HMAC-SHA256 鉴权
- Base64 双重编解码
- 智能片段筛选（3-6秒）

---

### 3️⃣ ASR 修正模块

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `asr_cluster_corrector.py` | 根目录 | ASR 聚类修正器（DER 优化） | ⭐⭐⭐ 必需 |

**核心功能**：
- ✅ 基于声纹识别修正 ASR 聚类错误
- ✅ DER（说话人区分错误率）计算
- ✅ 保底机制（识别失败不崩溃）

---

### 4️⃣ 主流程模块

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `main_pipeline.py` | 根目录 | 端到端主流程 | ⭐⭐⭐ 必需 |

**核心功能**：
- ✅ ASR → 声纹识别 → 实名会议纪要
- ✅ 完整的异常处理
- ✅ 详细的日志输出

---

### 5️⃣ LLM 会议总结模块

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `meeting_summarizer.py` | 根目录 | 会议纪要生成器 | ⭐⭐ 重要 |

**注意**：
- ⚠️ 当前使用的是 OpenRouter API
- 🔄 需要改造为 Gemini 3 Pro
- 💡 保留作为参考，了解会议总结的逻辑

---

### 6️⃣ 评估工具模块

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `transcription_tester.py` | `transcribers/` | 测试框架基类（含 CER/DER 计算） | ⭐⭐ 重要 |

**核心功能**：
- ✅ CER（字错误率）计算
- ✅ DER（说话人区分错误率）计算
- ✅ 时间戳偏移计算
- ✅ 使用 pyannote.metrics 专业库

**建议**：
- 提取评估函数到独立模块
- 供新项目的质量评估使用

---

### 7️⃣ 配置文件

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `AzureSecretKey.csv` | `config/` | Azure 密钥 | ⭐⭐⭐ 必需 |
| 讯飞配置 | 环境变量 | APP_ID, API_KEY, API_SECRET | ⭐⭐⭐ 必需 |
| TOS 配置 | 环境变量 | ACCESS_KEY, SECRET_KEY | ⭐⭐⭐ 必需 |

---

### 8️⃣ 文档参考

| 文件 | 路径 | 说明 | 优先级 |
|------|------|------|--------|
| `分差挽救机制说明.md` | 根目录 | 声纹识别优化技术 | ⭐⭐ 重要 |
| `项目完成总结.md` | 根目录 | 项目总结和技术亮点 | ⭐ 参考 |
| `评估逻辑审查报告.md` | 根目录 | CER/DER 计算逻辑审查 | ⭐ 参考 |

---

## 📋 打包清单（按模块分类）

### 核心代码文件（9个）

```
新项目/AI参考文件夹/
├── 1_ASR转写/
│   ├── volcano_transcriber_v3.py          # 火山引擎转写器
│   ├── azure_transcriber.py               # Azure 转写器（备用）
│   └── transcription_tester.py            # 测试框架（含评估逻辑）
│
├── 2_声纹识别/
│   ├── iflytek_voiceprint.py              # 讯飞声纹识别客户端
│   ├── audio_processor.py                 # 音频处理器
│   └── asr_cluster_corrector.py           # ASR 修正器
│
├── 3_主流程/
│   └── main_pipeline.py                   # 端到端主流程
│
├── 4_LLM总结/
│   └── meeting_summarizer.py              # 会议总结器（需改造）
│
└── 5_配置文件/
    └── AzureSecretKey.csv                 # Azure 密钥
```

### API 文档（4个）

```
新项目/AI参考文件夹/API文档/
├── 火山API文档.txt
├── azure api文档.txt
├── 讯飞声纹识别api.txt
└── 火山热词.txt
```

### 技术文档（3个）

```
新项目/AI参考文件夹/技术文档/
├── 分差挽救机制说明.md                    # 声纹识别优化
├── 项目完成总结.md                        # 项目总结
└── 评估逻辑审查报告.md                    # 评估逻辑说明
```

---

## 🎯 新项目建议架构

```
新项目/
├── src/
│   ├── asr/                               # ASR 模块
│   │   ├── volcano_asr.py                 # 火山引擎（主力）
│   │   └── azure_asr.py                   # Azure（备用）
│   │
│   ├── voiceprint/                        # 声纹识别模块
│   │   ├── iflytek_client.py              # 讯飞客户端
│   │   ├── audio_processor.py             # 音频处理
│   │   └── cluster_corrector.py           # 聚类修正
│   │
│   ├── llm/                               # LLM 模块
│   │   └── gemini_summarizer.py           # Gemini 总结器
│   │
│   ├── pipeline/                          # 主流程
│   │   └── meeting_pipeline.py            # 端到端流程
│   │
│   └── utils/                             # 工具模块
│       ├── evaluation.py                  # 评估工具（CER/DER）
│       └── config.py                      # 配置管理
│
├── config/                                # 配置文件
│   ├── azure_config.yaml
│   ├── iflytek_config.yaml
│   └── gemini_config.yaml
│
├── tests/                                 # 测试
│
├── docs/                                  # 文档
│
└── AI参考文件夹/                          # 从旧项目迁移的参考代码
    ├── 1_ASR转写/
    ├── 2_声纹识别/
    ├── 3_主流程/
    ├── 4_LLM总结/
    ├── 5_配置文件/
    ├── API文档/
    └── 技术文档/
```

---

## 🔄 需要改造的部分

### 1. LLM 会议总结

**当前**：使用 OpenRouter API
```python
# meeting_summarizer.py
OPENROUTER_API_KEY = "..."
model = "google/gemini-2.0-flash-exp:free"
```

**改造为**：直接使用 Gemini 3 Pro API
```python
import google.generativeai as genai

genai.configure(api_key="YOUR_GEMINI_API_KEY")
model = genai.GenerativeModel('gemini-3-pro')
```

### 2. 配置管理

**建议**：统一使用配置文件（YAML）而不是硬编码

```yaml
# config/asr_config.yaml
volcano:
  access_key: ${TOS_ACCESS_KEY}
  secret_key: ${TOS_SECRET_KEY}
  endpoint: https://tos-cn-beijing.volces.com
  region: cn-beijing
  bucket: meeting-agent-test

azure:
  subscription_key: ${AZURE_KEY}
  region: eastus
```

### 3. 模块化

**建议**：每个模块独立，便于测试和维护

```python
# 旧项目：所有逻辑在一个文件
# 新项目：模块化设计

from src.asr import VolcanoASR, AzureASR
from src.voiceprint import IFlyTekVoiceprint
from src.llm import GeminiSummarizer
from src.pipeline import MeetingPipeline

# 组装流程
pipeline = MeetingPipeline(
    asr=VolcanoASR(),
    voiceprint=IFlyTekVoiceprint(),
    summarizer=GeminiSummarizer()
)
```

---

## 📦 打包命令

创建一个脚本来自动打包：

```bash
# 创建目录结构
mkdir -p "新项目/AI参考文件夹/1_ASR转写"
mkdir -p "新项目/AI参考文件夹/2_声纹识别"
mkdir -p "新项目/AI参考文件夹/3_主流程"
mkdir -p "新项目/AI参考文件夹/4_LLM总结"
mkdir -p "新项目/AI参考文件夹/5_配置文件"
mkdir -p "新项目/AI参考文件夹/API文档"
mkdir -p "新项目/AI参考文件夹/技术文档"

# 复制核心代码
cp transcribers/volcano_transcriber_v3.py "新项目/AI参考文件夹/1_ASR转写/"
cp transcribers/azure_transcriber.py "新项目/AI参考文件夹/1_ASR转写/"
cp transcribers/transcription_tester.py "新项目/AI参考文件夹/1_ASR转写/"

cp iflytek_voiceprint.py "新项目/AI参考文件夹/2_声纹识别/"
cp audio_processor.py "新项目/AI参考文件夹/2_声纹识别/"
cp asr_cluster_corrector.py "新项目/AI参考文件夹/2_声纹识别/"

cp main_pipeline.py "新项目/AI参考文件夹/3_主流程/"

cp meeting_summarizer.py "新项目/AI参考文件夹/4_LLM总结/"

cp config/AzureSecretKey.csv "新项目/AI参考文件夹/5_配置文件/"

# 复制 API 文档
cp "api docs/火山API文档.txt" "新项目/AI参考文件夹/API文档/"
cp "api docs/azure api文档.txt" "新项目/AI参考文件夹/API文档/"
cp "api docs/讯飞声纹识别api.txt" "新项目/AI参考文件夹/API文档/"
cp "api docs/火山热词.txt" "新项目/AI参考文件夹/API文档/"

# 复制技术文档
cp 分差挽救机制说明.md "新项目/AI参考文件夹/技术文档/"
cp 项目完成总结.md "新项目/AI参考文件夹/技术文档/"
cp 评估逻辑审查报告.md "新项目/AI参考文件夹/技术文档/"
```

---

## ✅ 迁移检查清单

### 核心功能验证

- [ ] ASR 转写（火山引擎）
- [ ] ASR 转写（Azure 备用）
- [ ] 声纹识别（讯飞）
- [ ] 声纹样本提取
- [ ] ASR 聚类修正
- [ ] 主流程集成
- [ ] LLM 会议总结（需改造为 Gemini）

### 配置验证

- [ ] 火山引擎 TOS 配置
- [ ] Azure 密钥配置
- [ ] 讯飞声纹识别配置
- [ ] Gemini API 配置（新增）

### 文档完整性

- [ ] API 文档齐全
- [ ] 技术文档齐全
- [ ] 使用说明齐全

---

## 🎉 总结

### 核心文件数量

- **代码文件**：9 个
- **API 文档**：4 个
- **技术文档**：3 个
- **配置文件**：1 个
- **总计**：17 个文件

### 关键技术点

1. **ASR 转写**：火山引擎（主力）+ Azure（备用）
2. **声纹识别**：讯飞 1:N 检索 + 分差挽救机制
3. **ASR 修正**：基于声纹识别的聚类修正
4. **评估工具**：CER/DER 计算（pyannote.metrics）
5. **LLM 总结**：需改造为 Gemini 3 Pro

### 新项目优势

- ✅ 架构清晰，模块化设计
- ✅ 主力 + 备用方案，可靠性高
- ✅ 完整的评估体系
- ✅ 参考代码齐全，便于开发

---

**迁移清单创建时间**: 2025-01-12  
**核心文件数**: 17 个  
**建议新项目架构**: 模块化 + 配置化
